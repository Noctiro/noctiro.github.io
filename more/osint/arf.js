var root,margin=[20,120,20,140],width=1280-margin[1]-margin[3],height=800-margin[0]-margin[2],i=0,duration=1250,tree=d3.layout.tree().size([height,width]),diagonal=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),vis=d3.select("#body").append("svg:svg").attr("width",width+margin[1]+margin[3]).attr("height",height+margin[0]+margin[2]).append("svg:g").attr("transform","translate("+margin[3]+","+margin[0]+")");function update(n){var t=tree.nodes(root).reverse();t.forEach(function(t){t.y=180*t.depth});var r=vis.selectAll("g.node").data(t,function(t){return t.id||(t.id=++i)}),e=r.enter().append("svg:g").attr("class","node").attr("transform",function(t){return"translate("+n.y0+","+n.x0+")"}).on("click",function(t){toggle(t),update(t)});e.append("svg:circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),e.append("a").attr("target","_blank").attr("xlink:href",function(t){return t.url}).append("svg:text").attr("x",function(t){return t.children||t._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name}).style("fill: rgb(0, 0, 0)",function(t){return t.free?"black":"#999"}).style("fill-opacity",1e-6),e.append("svg:title").text(function(t){return t.description});e=r.transition().duration(duration).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});e.select("circle").attr("r",6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),e.select("text").style("fill-opacity",1);r=r.exit().transition().duration(duration).attr("transform",function(t){return"translate("+n.y+","+n.x+")"}).remove();r.select("circle").attr("r",1e-6),r.select("text").style("fill-opacity",1e-6);r=vis.selectAll("path.link").data(tree.links(t),function(t){return t.target.id});r.enter().insert("svg:path","g").attr("class","link").attr("d",function(t){var r={x:n.x0,y:n.y0};return diagonal({source:r,target:r})}).transition().duration(duration).attr("d",diagonal),r.transition().duration(duration).attr("d",diagonal),r.exit().transition().duration(duration).attr("d",function(t){var r={x:n.x,y:n.y};return diagonal({source:r,target:r})}).remove(),t.forEach(function(t){t.x0=t.x,t.y0=t.y})}function toggle(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}d3.json("arf.json",function(t){(root=t).x0=height/2,root.y0=0,root.children.forEach(function t(r){r.children&&(r._children=r.children,r._children.forEach(t),r.children=null)}),update(root)});